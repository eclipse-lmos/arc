(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[125],{50085:(e,s,t)=>{Promise.resolve().then(t.bind(t,57532))},57532:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>K});var l=t(95155),n=t(12115),a=t(62044),r=t(5418),i=t(92033),c=t(94979),o=t(40878),d=t(3998),x=t(65142),h=t(17037),m=t(47614),u=t(23262),p=t(68086),j=t(15894),f=t(11186),g=t(16789),v=t(86948),b=t(90576),N=t(66710),w=t(26615),y=t(90925);class S{static getInstance(){return S.instance||(S.instance=new S),S.instance}subscribe(e){this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter(s=>s!==e)}constructor(){this.eventSource=null,this.subscribers=[],this.eventSource=new y.EventSourcePolyfill("http://localhost:8080/events"),this.eventSource.onmessage=e=>{if(console.log("Received event:",e.data),"heartbeat"!==e.data)try{let s=JSON.parse(e.data);this.subscribers.forEach(e=>e(s))}catch(e){console.log("Error on event:",e)}},this.eventSource.onerror=e=>{this.eventSource&&this.eventSource.close()}}}let k=S.getInstance();var C=t(13496);function T(e){let{event:s}=e;return(0,l.jsxs)(v.Zp,{className:"font-mono text-xs",children:[(0,l.jsx)(v.aR,{className:"p-2",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(r.A,{className:"h-4 w-4"}),(0,l.jsx)(v.ZB,{className:"text-sm font-semibold",children:s.event})]})}),(0,l.jsxs)(v.Wu,{className:"p-2 space-y-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Model:"})," ",s.model]}),(0,l.jsx)(C.nD,{type:"single",collapsible:!0,className:"w-full text-xs",children:(0,l.jsxs)(C.As,{value:"item-1",className:"border-b-0",children:[(0,l.jsx)(C.$m,{className:"p-0 hover:no-underline font-normal",children:(0,l.jsx)("strong",{children:"Result:"})}),(0,l.jsx)(C.ub,{className:"pt-2",children:(0,l.jsx)("pre",{className:"p-2 bg-muted rounded whitespace-pre-wrap",children:(0,l.jsx)("code",{children:s.result})})})]})}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsxs)("span",{children:[(0,l.jsx)("strong",{children:"Total Tokens:"})," ",s.totalTokens]}),(0,l.jsxs)("span",{children:[(0,l.jsx)("strong",{children:"Prompt:"})," ",s.promptTokens]}),(0,l.jsxs)("span",{children:[(0,l.jsx)("strong",{children:"Completion:"})," ",s.completionTokens]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Tool Calls:"})," ",s.toolCallCount]})]})]})}var E=t(26991),A=t(86790),R=t(68425),I=t(47734),z=t(73697),P=t(23508),_=t(7620),q=t(47643);function W(e){let{events:s}=e,t=s.map((e,s)=>({name:"E".concat(s+1),total:e.totalTokens,prompt:e.promptTokens,completion:e.completionTokens})).reverse();return(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{className:"p-4",children:(0,l.jsx)(v.ZB,{className:"text-base",children:"Token Usage"})}),(0,l.jsx)(v.Wu,{className:"p-0",children:(0,l.jsx)(E.u,{width:"100%",height:150,children:(0,l.jsxs)(A.b,{data:t,margin:{top:5,right:20,left:-10,bottom:5},children:[(0,l.jsx)(R.d,{strokeDasharray:"3 3"}),(0,l.jsx)(I.W,{dataKey:"name"}),(0,l.jsx)(z.h,{}),(0,l.jsx)(P.m,{}),(0,l.jsx)(_.s,{}),(0,l.jsx)(q.N,{type:"monotone",dataKey:"total",stroke:"#8884d8",name:"Total"}),(0,l.jsx)(q.N,{type:"monotone",dataKey:"prompt",stroke:"#82ca9d",name:"Prompt"}),(0,l.jsx)(q.N,{type:"monotone",dataKey:"completion",stroke:"#ffc658",name:"Completion"})]})})})]})}function Z(){let[e,s]=(0,n.useState)([]),[t,a]=(0,n.useState)(!1),r=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=e=>{s(s=>[e,...s].slice(0,100))};return k.subscribe(e),()=>{k.unsubscribe(e)}},[]),(0,n.useEffect)(()=>{if(r.current){let e=r.current.querySelector("div[data-radix-scroll-area-viewport]");e&&(e.scrollTop=0)}},[e]);let i=e.filter(e=>"LLMFinishedEvent"===e.event);return(0,l.jsxs)(v.Zp,{className:"h-full flex flex-col light:bg-transparent light:border-0",children:[(0,l.jsxs)(v.aR,{className:"p-4 flex flex-row items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(b.A,{className:"h-4 w-4 text-primary"}),(0,l.jsx)(v.ZB,{className:"text-base font-semibold",children:"Agent Events"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(d.$,{variant:"ghost",size:"icon",onClick:()=>a(!t),className:"h-6 w-6",children:[(0,l.jsx)(N.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Toggle graph"})]}),(0,l.jsxs)(d.$,{variant:"ghost",size:"icon",onClick:()=>{s([])},className:"h-6 w-6",children:[(0,l.jsx)(w.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Clear events"})]})]})]}),(0,l.jsx)(v.Wu,{className:"flex-1 overflow-hidden p-0",children:t?(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)(W,{events:i})}):(0,l.jsx)(h.F,{className:"h-full",ref:r,children:(0,l.jsx)("div",{className:"p-4 text-sm",children:0===e.length?(0,l.jsx)("p",{className:"text-muted-foreground text-center pt-8",children:"Waiting for events..."}):(0,l.jsx)("ul",{className:"space-y-2",children:e.map((e,s)=>(0,l.jsx)("li",{children:"LLMFinishedEvent"===e.event?(0,l.jsx)(T,{event:e}):(0,l.jsx)("div",{className:"font-mono bg-muted/50 p-2 rounded-lg text-xs border",children:(0,l.jsx)("pre",{children:(0,l.jsx)("code",{children:JSON.stringify(e,null,2)})})})},s))})})})})]})}let F=e=>{let{selectedRole:s,onRoleChange:t,roles:n,messages:a,isThinking:o,scrollAreaRef:u,onFormSubmit:p,input:j,onInputChange:g,selectedPrompt:v}=e;return(0,l.jsxs)("div",{className:"flex h-full flex-col overflow-hidden",children:[(0,l.jsx)("div",{className:"border-b p-4 light:bg-white",children:(0,l.jsxs)(f.l6,{onValueChange:e=>t("none"===e?null:e),value:s||"none",children:[(0,l.jsx)(f.bq,{className:"w-full max-w-sm mx-auto",children:(0,l.jsx)(f.yv,{placeholder:"Select a role..."})}),(0,l.jsxs)(f.gC,{children:[(0,l.jsx)(f.eb,{value:"none",children:"No Role"}),n.map(e=>(0,l.jsx)(f.eb,{value:e.id,children:e.name},e.id))]})]})}),0!==a.length||o?(0,l.jsx)(h.F,{className:"flex-1",ref:u,children:(0,l.jsxs)("div",{className:"mx-auto w-full max-w-2xl space-y-6 p-4 md:p-6",children:[a.map((e,s)=>(0,l.jsx)(m.A,{message:e},s)),o&&(0,l.jsxs)("div",{className:"flex items-start gap-4",children:[(0,l.jsx)("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-primary text-primary-foreground",children:(0,l.jsx)(r.A,{className:"h-5 w-5"})}),(0,l.jsxs)("div",{className:"flex-1 rounded-lg border p-4 text-sm bg-card flex items-center gap-2 light:bg-white",children:[(0,l.jsx)(i.A,{className:"h-4 w-4 animate-spin"}),(0,l.jsx)("span",{children:"Thinking..."})]})]})]})}):(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center p-4 rounded-lg",children:[(0,l.jsx)(r.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,l.jsx)("h2",{className:"mt-4 text-xl font-semibold",children:"Assistant"}),(0,l.jsx)("p",{className:"mt-1 text-muted-foreground",children:"Start a conversation to begin."})]})}),(0,l.jsx)("div",{className:"border-t bg-background p-4 md:p-6 light:bg-white",children:(0,l.jsxs)("form",{onSubmit:p,className:"flex items-center gap-2 max-w-4xl mx-auto",children:[(0,l.jsx)(x.p,{value:j,onChange:e=>g(e.target.value),placeholder:"Type a message...",disabled:o||!v}),(0,l.jsxs)(d.$,{type:"submit",size:"icon",disabled:o||!j.trim()||!v,children:[(0,l.jsx)(c.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Send"})]})]})})]})};function K(){var e,s;let[t,r]=(0,n.useState)(!1);(0,n.useEffect)(()=>{r(!0)},[]);let[i,c]=(0,n.useState)([]),[d,x]=(0,n.useState)(""),[h,m]=(0,n.useState)(!1),[f,v]=(0,n.useState)(null),b=(0,n.useRef)(""),N=(0,n.useRef)(null),[w,y]=(0,n.useTransition)(),{toast:S}=(0,j.dj)(),[k]=(0,a.IT)({query:u.g3,variables:{term:""},pause:!t}),C=(null==(e=k.data)?void 0:e.list)||[],[T]=(0,a.IT)({query:u.sz,pause:!t}),E=(null==(s=T.data)?void 0:s.rolePrompts)||[],[A,R]=(0,a.n_)(p.of),I=(0,n.useMemo)(()=>C.length>0?C[0].id:null,[C]);(0,n.useEffect)(()=>{y(()=>{b.current="conv-".concat(Date.now()),c([])})},[I,f]),(0,n.useEffect)(()=>{if(N.current){let e=N.current.querySelector("div[data-radix-scroll-area-viewport]");e&&(e.scrollTop=e.scrollHeight)}},[i]);let z=(0,n.useCallback)(e=>{if(!I)return void S({variant:"destructive",title:"No prompt available",description:"Please create a prompt to start the conversation."});let s=[];f&&s.push({key:"role",value:f}),m(!0),R({input:{useCasesId:I,request:{messages:e.map(e=>{let{role:s,content:t,format:l}=e;return{role:s,content:t,format:l}}),userContext:{profile:[]},systemContext:s,conversationContext:{conversationId:b.current}}}}).then(e=>{let{data:s,error:t}=e;if(m(!1),t)S({variant:"destructive",title:"Error getting assistant response",description:t.message}),c(e=>[...e,{role:"assistant",content:"Sorry, I encountered an error.",format:"text"}]);else if(null==s?void 0:s.assistant){var l,n;let e=(s.assistant.messages||[]).map(e=>{let{__typename:s,...t}=e;return t}),t=null==(l=s.assistant.context)?void 0:l.map(e=>{let{__typename:s,...t}=e;return t}),a=null==(n=s.assistant.toolCalls)?void 0:n.map(e=>{let{__typename:s,...t}=e;return t});if(e.length>0){let s=e[e.length-1];"assistant"===s.role&&(t&&t.length>0&&(s.context=t),a&&a.length>0&&(s.toolCalls=a)),c(s=>[...s,...e])}else if(a&&a.length>0){let e={role:"assistant",content:"",format:"text",toolCalls:a};t&&t.length>0&&(e.context=t),c(s=>[...s,e])}}})},[R,I,S,f]);return(0,l.jsxs)("div",{className:"flex h-screen w-full flex-col bg-background light:bg-gray-100",children:[(0,l.jsx)(o.default,{}),(0,l.jsx)("main",{className:"flex flex-1 overflow-hidden",children:(0,l.jsxs)(g.HK,{direction:"horizontal",children:[(0,l.jsx)(g.wV,{defaultSize:75,children:(0,l.jsx)(F,{selectedRole:f,onRoleChange:v,roles:E,messages:i,isThinking:h,scrollAreaRef:N,onFormSubmit:e=>{if(e.preventDefault(),!d.trim()||h)return;let s=[...i,{role:"user",content:d,format:"text"}];c(s),z(s),x("")},input:d,onInputChange:x,selectedPrompt:I})}),(0,l.jsx)(g.WM,{withHandle:!0}),(0,l.jsx)(g.wV,{defaultSize:25,children:(0,l.jsx)("div",{className:"h-full p-4",children:(0,l.jsx)(Z,{})})})]})})]})}}},e=>{e.O(0,[330,150,394,34,229,387,878,11,441,255,358],()=>e(e.s=50085)),_N_E=e.O()}]);